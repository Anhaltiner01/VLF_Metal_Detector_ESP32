ESP32 Digital VLF Metal Detector (Hybrid App)üá¨üáß English Version | üá©üá™ Deutsche Version<a name="english"></a>üá¨üáß ESP32 Digital VLF Metal DetectorA modern, fully digital VLF (Very Low Frequency) metal detector project powered by the ESP32 microcontroller. This project combines high-performance digital signal processing (DSP) on the hardware side with a responsive, web-based user interface running inside an Android App (via MIT App Inventor).üåü Key FeaturesFirmware (ESP32)VLF/IB Technology: Induction Balance method with digital phase and magnitude calculation.Full Digital Processing:Precise signal generation using ESP32 MCPWM unit.Oversampling and digital filtering (EMA) of ADC inputs.Vector math to determine VDI (Visual Discrimination Indicator) and signal strength.Bluetooth Low Energy (BLE): Efficient communication with the smartphone.Auto-Calibration: Systems for Ground Balance and Maximum Signal reference.Hardware Control: Support for LED Flashlight (via MOSFET) and battery monitoring.Hybrid App & UI (HTML/JS + AI2)The app is designed as a hybrid application. The logic and UI are written in standard web technologies (HTML/CSS/JS) but hosted within a native Android container.Real-time Visualization: Chart.js renders live graphs of VDI and Signal Strength.Metal Discrimination: Visual categorization (Iron, Foil, Gold, Silver, etc.) with touch-to-disable segments.Audio Engine: Tone generation uses the Web Audio API (sound.js) to generate lag-free audio directly in the WebView.Control Center: Adjust Sensitivity, Sample Rate, Phase Shift, and toggle Flashlight ('M'/'N' commands).üèóÔ∏è System ArchitectureThis project uses a unique approach to UI development for microcontrollers:The Host (MIT App Inventor): The Android app handles the BLE connection to the ESP32. It acts as a wrapper.The View (WebViewer): The app contains a WebViewer component that loads local HTML files (index.html for UI, ton.html for Audio).The Bridge: Data is passed between the App logic (Blocks) and the JavaScript (logic.js) using the WebViewString property.ESP32 -> BLE -> AI2 -> WebViewString -> JavaScript (Update UI)JavaScript -> WebViewString -> AI2 -> BLE -> ESP32 (Send Commands)üõ†Ô∏è Hardware SetupCore: ESP32 Development BoardPinoutFunctionGPIODescriptionTX Coil25PWM Transmit SignalRX X-Channel34Analog In (In-Phase / Sensor VP)RX R-Channel35Analog In (Quadrature / Sensor VN)Vref26DAC Output (Reference Voltage)Phase X Ref32Demodulator Reference (X)Phase R Ref33Demodulator Reference (R)Flashlight4LED Control (via MOSFET Gate)Battery39Voltage Divider InputStatus LED2Onboard LEDFlashlight CircuitTo control the high-power LED, use an N-Channel Logic-Level MOSFET (e.g., IRLZ44N):Gate: GPIO 4 (via 100Œ© resistor + 10kŒ© pull-down).Drain: LED Cathode (-).Source: GND.üíª Installation & Flashing1. ESP32 FirmwareInstall Arduino IDE.Install the ESP32 Board Package.Required Libraries: EEPROM, BLEDevice.Open VLF_Metal_Detector_ESP32.ino, select your board, and flash.2. Android App (MIT App Inventor)Create a project at MIT App Inventor.Import Assets: Upload the following files to the "Media" section of your project:index.html (Main UI)ton.html (Audio Engine container)logic.js (UI Logic)sound.js (Audio Logic)chart.js (Graph Library)Images (Sondeln.png, VDIImage.png)WebView Setup: Set the HomeUrl of your WebViewer component to file:///android_asset/index.html.BLE Logic: Implement the BLE block logic to read strings from the ESP32 and pass them to WebViewer.WebViewString.üìÑ LicenseMIT License - Copyright (c) 2025 Anhaltiner01<a name="deutsch"></a>üá©üá™ ESP32 Digitaler VLF MetalldetektorEin modernes, digitales VLF (Very Low Frequency) Metalldetektor-Projekt auf Basis des ESP32 Mikrocontrollers. Dieses Projekt kombiniert leistungsf√§hige digitale Signalverarbeitung (DSP) auf dem ESP32 mit einer modernen, webbasierten Benutzeroberfl√§che, die in einer Android-App (via MIT App Inventor) l√§uft.üåü FunktionenFirmware (ESP32)VLF/IB Technologie: Basiert auf dem Induktions-Balance-Verfahren mit digitaler Phasen- und Signalauswertung.Volldigitale Verarbeitung:Hochpr√§zise Signalerzeugung mittels ESP32 MCPWM.Oversampling und digitale Filterung (EMA) der ADC-Werte.Vektor-Berechnung (Magnitude & Phase) zur Bestimmung von Metallart (VDI) und Tiefe.Bluetooth Low Energy (BLE): Energiesparende Kommunikation mit dem Smartphone.Automatische Kalibrierung:Ground Balance: Abgleich der Bodenmineralisierung.Max Signal: Kalibrierung auf Referenzobjekte.Hardware-Steuerung: Unterst√ºtzung f√ºr eine Beleuchtungs-LED (MOSFET an GPIO 4) und Batteriemessung.Hybrid App & UI (HTML/JS + AI2)Die Benutzeroberfl√§che ist als Hybrid-App konzipiert. Die Logik l√§uft in Web-Technologies, eingebettet in eine native Android H√ºlle.Echtzeit-Visualisierung: Graphische Darstellung von VDI (Leitwert) und Signalst√§rke mittels Chart.js.Metall-Diskriminierung: Visuelle Unterscheidung von Metallen (Eisen, Folie, Gold, Silber, Kupfer) mit anpassbarem Notch-Filter durch Antippen.Audio Engine: Erzeugung von T√∂nen direkt im Webview via Web Audio API (sound.js), basierend auf dem erkannten Metall (keine Latenz durch Bluetooth-Audio-Streaming).Einstellungen: Fernsteuerung aller Parameter (Sensitivit√§t, Sample Rate, Phase) und Lichtsteuerung ('M'/'N' Befehle).üèóÔ∏è Systemarchitektur & App-ErstellungDieses Projekt nutzt einen hybriden Ansatz f√ºr die App-Entwicklung:Der Host (MIT App Inventor): Die Android-App verwaltet die BLE-Verbindung zum ESP32. Sie dient als Container.Die Ansicht (WebViewer): Die App enth√§lt eine WebViewer-Komponente, die lokale HTML-Dateien l√§dt (index.html f√ºr die UI, ton.html f√ºr Audio).Die Br√ºcke: Daten werden zwischen der App-Logik (Bl√∂cke) und dem JavaScript (logic.js) √ºber die Eigenschaft WebViewString ausgetauscht.ESP32 sendet Daten -> BLE -> AI2 -> WebViewString -> JavaScript (Update der Charts/Werte)JavaScript Button -> WebViewString -> AI2 -> BLE -> ESP32 (Senden von Befehlen)üõ†Ô∏è Hardware AufbauKern: ESP32 Development BoardPinbelegungFunktionGPIOBeschreibungTX Spule25Sendesignal (PWM)RX X-Kanal34Analog-Eingang In-Phase (Sensor VP)RX R-Kanal35Analog-Eingang Quadratur (Sensor VN)Vref26Referenzspannung (DAC Ausgang)Phase X Ref32Referenzsignal f√ºr Demodulator (X)Phase R Ref33Referenzsignal f√ºr Demodulator (R)Beleuchtung4LED-Steuerung (via MOSFET Gate)Batterie39Spannungsteiler zur MessungStatus LED2Onboard LED (Status/Heartbeat)Beleuchtungs-SchaltungF√ºr die LED-Beleuchtung wird ein N-Channel Logic-Level MOSFET empfohlen (z.B. IRLZ44N):Gate: an GPIO 4 (mit 100Œ© Widerstand + 10kŒ© Pull-Down gegen GND).Drain: an LED Kathode (-).Source: an GND.üíª Installation1. ESP32 FirmwareInstalliere die Arduino IDE.Installiere das ESP32 Board Package √ºber den Boardverwalter.Ben√∂tigte Bibliotheken: EEPROM, BLEDevice.√ñffne VLF_Metal_Detector_ESP32.ino, w√§hle das Board und flashe den Code.2. Android App (MIT App Inventor)Erstelle ein Projekt in MIT App Inventor.Assets Importieren: Lade folgende Dateien als Media Assets hoch:index.html (Haupt-UI)ton.html (Audio-Engine Container)logic.js (Steuerungslogik)sound.js (Audio Logik)chart.js (Diagramm-Bibliothek)Bilder (Sondeln.png, VDIImage.png)WebView Konfiguration: Setze die HomeUrl des WebViewers auf file:///android_asset/index.html.BLE Logik: Erstelle die Block-Logik, um Strings vom ESP32 zu empfangen und an WebViewer.WebViewString weiterzuleiten.üì± BedienungStart: Schalte den ESP32 ein und starte die App.Verbindung: Die App verbindet sich √ºber BLE (ESP32 Metal Detector).Kalibrierung (Wichtig!):Tab Calibration w√§hlen.Spule in die Luft halten.Start Ground Balance dr√ºcken und Spule "pumpen".Suche:Tab Status w√§hlen.Diagramm beobachten (Orange = Material, Blau = St√§rke).Licht: Mit den Befehlen in der App (oder Buttons, falls implementiert) kann das Licht an GPIO 4 geschaltet werden.üìÑ LizenzMIT Lizenz - Copyright (c) 2025 Anhaltiner01